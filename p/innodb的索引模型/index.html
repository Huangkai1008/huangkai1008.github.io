<!doctype html><html lang=zh-cn>
<head><meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="InnoDB 的索引模型 一、前言 什么是索引 索引（index） 的出现是为了提高数据查询的效率，索引的实现一般会使用特定的数据结构，我们可以使用不同的数据结"><title>InnoDB的索引模型</title>
<link rel=canonical href=https://huangkai1008.github.io/p/innodb%E7%9A%84%E7%B4%A2%E5%BC%95%E6%A8%A1%E5%9E%8B/>
<link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="InnoDB的索引模型">
<meta property="og:description" content="InnoDB 的索引模型 一、前言 什么是索引 索引（index） 的出现是为了提高数据查询的效率，索引的实现一般会使用特定的数据结构，我们可以使用不同的数据结">
<meta property="og:url" content="https://huangkai1008.github.io/p/innodb%E7%9A%84%E7%B4%A2%E5%BC%95%E6%A8%A1%E5%9E%8B/">
<meta property="og:site_name" content="Huanghuang's Blog">
<meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="mysql"><meta property="article:tag" content="innodb"><meta property="article:published_time" content="2020-11-03T08:40:31+08:00"><meta property="article:modified_time" content="2020-11-06T23:22:31+08:00"><meta property="og:image" content="https://blog-1259169620.cos.ap-guangzhou.myqcloud.com/img/B_Tree_Structure.png">
<meta name=twitter:title content="InnoDB的索引模型">
<meta name=twitter:description content="InnoDB 的索引模型 一、前言 什么是索引 索引（index） 的出现是为了提高数据查询的效率，索引的实现一般会使用特定的数据结构，我们可以使用不同的数据结"><meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://blog-1259169620.cos.ap-guangzhou.myqcloud.com/img/B_Tree_Structure.png">
<link rel="shortcut icon" href=https://blog-1259169620.cos.ap-guangzhou.myqcloud.com/img/20211018164707.jpg>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-149768628-1','auto'),ga('send','pageview'))</script>
</head>
<body class="article-page has-toc">
<script>(function(){const a='StackColorScheme';localStorage.getItem(a)||localStorage.setItem(a,"auto")})()</script><script>(function(){const b='StackColorScheme',a=localStorage.getItem(b),c=window.matchMedia('(prefers-color-scheme: dark)').matches===!0;a=='dark'||a==='auto'&&c?document.documentElement.dataset.scheme='dark':document.documentElement.dataset.scheme='light'})()</script>
<div class="container main-container flex
extended">
<div id=article-toolbar>
<a href=/ class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg>
<span>Back</span>
</a>
</div>
<main class="main full-width">
<article class="has-image main-article">
<header class=article-header>
<div class=article-image>
<a href=/p/innodb%E7%9A%84%E7%B4%A2%E5%BC%95%E6%A8%A1%E5%9E%8B/>
<img src=https://blog-1259169620.cos.ap-guangzhou.myqcloud.com/img/B_Tree_Structure.png loading=lazy alt="Featured image of post InnoDB的索引模型">
</a>
</div>
<div class=article-details>
<header class=article-category>
<a href=/categories/mysql/>
mysql
</a>
</header>
<h2 class=article-title>
<a href=/p/innodb%E7%9A%84%E7%B4%A2%E5%BC%95%E6%A8%A1%E5%9E%8B/>InnoDB的索引模型</a>
</h2>
<footer class=article-time>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Nov 03, 2020</time>
</div>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>
4 minute read
</time>
</div>
</footer>
</div>
</header>
<section class=article-content>
<h1 id=innodb-的索引模型>InnoDB 的索引模型</h1>
<h2 id=一前言>一、前言</h2>
<h2 id=什么是索引>什么是索引</h2>
<p><strong>索引（<code>index</code>）</strong> 的出现是为了提高数据查询的效率，索引的实现一般会使用特定的数据结构，我们可以使用不同的数据结构实现不同的索引模型。</p>
<h2 id=索引的常见模型>索引的常见模型</h2>
<p>索引的常见模型有 <strong>哈希表（<code>hash-table</code>）</strong> 、<strong>有序数组（<code>array</code>）</strong> 和 <strong>搜索树（<code>search tree</code>）</strong>。</p>
<p>其中<strong>哈希表适用于只有等值查询的场景</strong>，例如 Memcached 及其他一些 NoSQL 引擎。</p>
<p><strong>有序数组在等值查询和范围查询场景中的性能都很优秀</strong>，但是对于需要更新数据的场景就显得成本太高，<strong>所以有序数组索引只适用于静态存储引擎</strong> 。</p>
<p>关于搜索树，我们最熟悉的应该是 <strong>二分搜索树（<code>binary-search tree</code>）</strong>。如果需要维持 <code>O(log(N))</code> 的查询复杂度和更新复杂度，则需要维护这个二分搜索树为平衡二叉树。为了让一个查询尽量少地读磁盘，就必须让查询过程访问尽量少的数据块。那么，我们就不应该使用二叉树，而是要使用“ N 叉 ”树。这里，“ N 叉 ”树中的 <code>N</code> 取决于数据块的大小。</p>
<h2 id=二innodb-的索引模型>二、InnoDB 的索引模型</h2>
<p><strong>InnoDB 使用了 B+ 树索引模型</strong>，数据都是存储在 B+ 树中的。每一个索引在 InnoDB 里面对应一棵 B+ 树，每棵 B+ 树的节点都是<a class=link href=InnoDB%20%e7%b4%a2%e5%bc%95%e9%a1%b5.md#InnoDB%20%e7%b4%a2%e5%bc%95%e9%a1%b5>索引页</a>。B+ 树是平衡树，查找任意节点所耗费的时间都是完全相同的，比较的次数就是 B+ 树的高度。</p>
<h3 id=叶子节点与非叶子节点>叶子节点与非叶子节点</h3>
<p>B + 树的节点都是索引页，最底层的节点，也即叶子节点被称为 <code>leaf page</code> , 非叶子节点被称为<code>non-leaf page</code> 或者 <code>internal page</code>，所以有时非叶子节点也称为内节点。</p>
<p>叶子节点包含实际的行数据，内节点仅包含指向其他叶子节点或非叶子节点的指针。</p>
<p>其中<a class=link href=InnoDB%20%e8%ae%b0%e5%bd%95%e5%ad%98%e5%82%a8%e6%a0%bc%e5%bc%8f.md#%e8%ae%b0%e5%bd%95%e5%a4%b4%e4%bf%a1%e6%81%af>记录头信息</a>中的一个字段 <code>record_type</code> 也可以体现叶子节点和非叶子节点的不同：</p>
<ul>
<li><strong>record_type = 0</strong>: 普通的用户记录（叶子节点中的记录)</li>
<li><strong>record_type = 1</strong>: 目录项记录（内节点中的记录）</li>
<li><strong>record_type = 2</strong>: Infimum 记录</li>
<li><strong>record_type = 3</strong>: Supremum 记录</li>
</ul>
<h3 id=聚簇索引与二级索引>聚簇索引与二级索引</h3>
<p><strong>聚簇索引（<code>clustered index</code>)</strong> 也称为主键索引，即用主键列创建的索引都是聚簇索引，其他列创建的索引都是 <strong>二级索引（<code>secondary index</code>）</strong> 也即非主键索引。</p>
<p><strong>两者的主要区别在于聚簇索引的叶子节点存储的是完整的用户记录，而二级索引的叶子节点只存储对应列和主键这两个列的值。</strong></p>
<h4 id=聚簇索引>聚簇索引</h4>
<p>聚簇索引以主键值的大小作为页和记录的排序规则。</p>
<p>聚簇索引下的页（包括叶子节点和内节点）内的记录按照主键值的大小顺序排成一个单向链表，页内的记录被划分为若干个组，每个组中主键值最大的记录在页内的偏移量会被当做槽依次存放在页目录中，我们可以通过二分法在页中快速定位到主键列等于某个值的记录。</p>
<p>同一层级各个索引页也是根据页中用户记录的主键值大小顺序排成一个双向链表。</p>
<p>最上层的那个节点为根节点，<strong>内节点页中的每条用户记录对应一个下层节点页，存储对应节点页的页号以及该叶子节点的最小主键值</strong>。</p>
<h4 id=二级索引>二级索引</h4>
<p>二级索引使用对应的索引列的大小进行记录和页的排序。</p>
<p>二级索引下的页（包括叶子节点和内节点）内的记录按照索引列的顺序排成一个单向链表，业内的记录被划分为若干个组，每个组中索引列值最大的记录在页内的偏移量会被当做槽依次存放在页目录中，我们可以通过二分法在页中快速定位到索引列等于某个值的记录。</p>
<p>同一层级各个索引页也是根据页中用户记录的索引列值的大小顺序排成一个双向链表。</p>
<p>最上层的那个节点为根节点，<strong>内节点页中的每条用户记录对应一个下层节点页，存储对应节点页的页号以及该叶子节点的最小索引列值</strong>。</p>
<p><strong>因为二级索引的叶子节点只存储索引列和主键这两个列的值，所以在需要其他列信息的情况下，需要找到一条符合条件的用户记录就根据此记录的主键信息去聚簇索引重新定位完整的用户记录，这个过程叫做回表。</strong></p>
<h4 id=联合索引>联合索引</h4>
<p><strong>联合索引(<code>multiple-column index</code>)</strong> 本质也是二级索引，只是索引列由一个列变成多个列，排序按照联合索引列的顺序多列排序。</p>
<p>联合索引只会创建一棵 B+ 树，这和多个列分别创建一个二级索引会创建多棵 B+ 树还是有着本质的不同。</p>
<h3 id=创建过程>创建过程</h3>
<p>聚簇索引默认就存在，不需要手动创建。当我们为某个列创建一个 B+ 树索引时，都会为这个索引创建一个根节点页，值得注意的是，<strong>这个根节点页创建之后页号就不会再改变</strong>。在开始没有数据的时候，每个 B+ 树索引对应的根节点中既没有用户记录，也没有目录项记录。</p>
<p>随后向表中插入用户记录时，先会把用户记录存储到这个根节点中。在根节点的可用空间用完时继续插入记录，此时会将根节点中的所有记录复制到一个新分配的页 a 中，然后对这个新页执行 <strong>页分裂</strong> 操作，得到另一个新页 b 。这时新插入的记录会根据键值的大小分配到页 b 或页 a 中。根节点此时便升级为存储目录项记录的页，也就需要把页 a 和页 b 对应的目录项记录插入到根节点中。</p>
<h2 id=参考资料>参考资料</h2>
<ul>
<li>小孩子 4919. (2020). <em>MySQL 是怎样运行的</em>. 人民邮电出版社.</li>
</ul>
</section>
<footer class=article-footer>
<section class=article-tags>
<a href=/tags/mysql/>mysql</a>
<a href=/tags/innodb/>innodb</a>
</section>
<section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>MIT</span>
</section>
<section class=article-lastmod><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<span>
Last updated on Nov 06, 2020 23:22 +0800
</span>
</section></footer>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css integrity=sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js integrity=sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js integrity=sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.querySelector(`.article-content`),{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})})</script>
</article>
<aside class=related-contents--wrapper>
<h2 class=section-title>Related contents</h2>
<div class=related-contents>
<div class="flex article-list--tile">
<article class=has-image>
<a href=/p/innodb-%E7%B4%A2%E5%BC%95%E9%A1%B5/>
<div class=article-image>
<img src=https://blog-1259169620.cos.ap-guangzhou.myqcloud.com/img/%E6%88%AA%E5%B1%8F2022-07-10%2010.15.54.png loading=lazy data-key data-hash=https://blog-1259169620.cos.ap-guangzhou.myqcloud.com/img/%E6%88%AA%E5%B1%8F2022-07-10%2010.15.54.png>
</div>
<div class=article-details>
<h2 class=article-title>InnoDB 索引页</h2>
</div>
</a>
</article>
<article class=has-image>
<a href=/p/innodb-%E8%AE%B0%E5%BD%95%E5%AD%98%E5%82%A8%E6%A0%BC%E5%BC%8F/>
<div class=article-image>
<img src=https://blog-1259169620.cos.ap-guangzhou.myqcloud.com/img/compact%E8%A1%8C%E6%A0%BC%E5%BC%8F.png loading=lazy data-key data-hash=https://blog-1259169620.cos.ap-guangzhou.myqcloud.com/img/compact%E8%A1%8C%E6%A0%BC%E5%BC%8F.png>
</div>
<div class=article-details>
<h2 class=article-title>InnoDB 记录存储格式</h2>
</div>
</a>
</article>
<article class=has-image>
<a href=/p/mysql%E7%9A%84%E5%9F%BA%E7%A1%80%E6%9E%B6%E6%9E%84/>
<div class=article-image>
<img src=https://blog-1259169620.cos.ap-guangzhou.myqcloud.com/img/mysql-architecture.png loading=lazy data-key data-hash=https://blog-1259169620.cos.ap-guangzhou.myqcloud.com/img/mysql-architecture.png>
</div>
<div class=article-details>
<h2 class=article-title>MySQL的基础架构</h2>
</div>
</a>
</article>
<article>
<a href=/p/mysql%E7%9A%84%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F/>
<div class=article-details>
<h2 class=article-title>MySQL的日志系统</h2>
</div>
</a>
</article>
<article>
<a href=/p/mysql%E7%9A%84%E4%BA%8B%E5%8A%A1/>
<div class=article-details>
<h2 class=article-title>MySQL的事务</h2>
</div>
</a>
</article>
</div>
</div>
</aside>
<div class=disqus-container>
<div id=disqus_thread></div>
<script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src="//huanghuang's blog.disqus.com/embed.js",a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
<a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
</div>
<style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style>
<script>window.addEventListener('onColorSchemeChange',a=>{DISQUS&&DISQUS.reset({reload:!0})})</script>
<footer class=site-footer>
<section class=copyright>
&copy;
2019 -
2022 Huanghuang's Blog
</section>
<section class=powerby>
Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> <br>
Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.2.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a>
</section>
</footer>
<div class=pswp tabindex=-1 role=dialog aria-hidden=true>
<div class=pswp__bg></div>
<div class=pswp__scroll-wrap>
<div class=pswp__container>
<div class=pswp__item></div>
<div class=pswp__item></div>
<div class=pswp__item></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class=pswp__top-bar>
<div class=pswp__counter></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class=pswp__preloader>
<div class=pswp__preloader__icn>
<div class=pswp__preloader__cut>
<div class=pswp__preloader__donut></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class=pswp__share-tooltip></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class=pswp__caption>
<div class=pswp__caption__center></div>
</div>
</div>
</div>
</div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous>
</main>
<aside class="sidebar right-sidebar sticky">
<section class="widget archives">
<div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg>
</div>
<h2 class="widget-title section-title">Table of contents</h2>
<div class=widget--toc>
<nav id=TableOfContents>
<ol>
<li><a href=#一前言>一、前言</a></li>
<li><a href=#什么是索引>什么是索引</a></li>
<li><a href=#索引的常见模型>索引的常见模型</a></li>
<li><a href=#二innodb-的索引模型>二、InnoDB 的索引模型</a>
<ol>
<li><a href=#叶子节点与非叶子节点>叶子节点与非叶子节点</a></li>
<li><a href=#聚簇索引与二级索引>聚簇索引与二级索引</a>
<ol>
<li><a href=#聚簇索引>聚簇索引</a></li>
<li><a href=#二级索引>二级索引</a></li>
<li><a href=#联合索引>联合索引</a></li>
</ol>
</li>
<li><a href=#创建过程>创建过程</a></li>
</ol>
</li>
<li><a href=#参考资料>参考资料</a></li>
</ol>
</nav>
</div>
</section>
</aside>
</div>
<script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const a=document.createElement('link');a.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",a.type="text/css",a.rel="stylesheet",document.head.appendChild(a)})()</script>
</body>
</html>